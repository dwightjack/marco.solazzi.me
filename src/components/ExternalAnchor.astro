---
import Icon from './Icon.astro';

export interface Props extends astroHTML.JSX.AnchorHTMLAttributes {
  variant?: 'cursor';
  icon?: string;
}

const { variant, icon, ...attrs } = Astro.props;
---

<a
  target="_blank"
  rel="noopener noreferrer external"
  aria-label={`${attrs.title ?? ''} (Opens in another tab)`.trim()}
  class:list={[
    'c-external-anchor',
    { [`c-external-anchor--${variant}`]: variant },
  ]}
  {...attrs}
>
  {
    icon && (
      <span class="c-external-anchor__icon">
        <Icon name={icon} size={1.2} />
      </span>
    )
  }
  <span class="c-external-anchor__label"><slot /></span>
</a>
<style>
  .c-external-anchor {
    color: currentcolor;
    text-decoration: none;
  }

  .c-external-anchor__icon {
    margin-inline-end: 0.2em;
  }

  .c-external-anchor--cursor .c-external-anchor__label::before {
    content: '';
    display: inline-block;
    inline-size: 0.5em;
    margin-inline-end: 0.1em;
    transform: translateY(0.1em);
    border-block-end: 2px solid currentcolor;
  }

  @media (--pointer-mouse) {
    .c-external-anchor--cursor:hover .c-external-anchor__label::before {
      animation-name: blinking-cursor;
      animation-duration: 0.7s;
      animation-timing-function: ease-out;
      animation-iteration-count: infinite;
      color: var(--color-link);
    }
  }

  @keyframes blinking-cursor {
    0% {
      opacity: 1;
    }

    30% {
      opacity: 0;
    }

    50% {
      opacity: 0;
    }

    100% {
      opacity: 1;
    }
  }
</style>
